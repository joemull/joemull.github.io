{% from "components/node_date_and_word_count.jinja" import node_date_and_word_count %}

<div class="webpage">
  {% include "components/meteor.jinja" %}
  <div class="container">
    {% include "components/site_header.jinja" %}
    <main>
      <article class="prose flow">
        {% if node.is_tag_index %}
          <h1 style="view-transition-name: {{ vt_name(node, "title") }};">
            Tag: {{ node.title }}
          </h1>
        {% else %}
          <h1 style="view-transition-name: {{ vt_name(node, "title") }};">
            {{ node.title }}
          </h1>
        {% endif %}
        {% if node.subtitle %}
          {{ node.subtitle }}
        {% endif %}
        {{ node_date_and_word_count(node) }}

        {% if node.image %}
          <img src="@root/images/{{ node.image }}" />
        {% endif %}

        {{ node.html }}

        {% if node.tags %}
          <p>Tagged: &nbsp;{{ node.tags|join(',&nbsp; ') }}</p>
        {% endif %}

        {% if node.is_dir_index or node.is_homepage_index %}
          {% for entry in node.index %}
            <div
              class="flow"
              {%- if entry.meta.get("type", "") == "slide_deck" -%}
                style="view-transition-name:
                {{ vt_name(entry, "slide_deck") }};"
              {%- endif -%}
            >
              {% include "components/article_in_list.jinja" %}
              {% if entry.image %}
                <div>
                  <a href="{{ entry.url }}">
                    <img src="@root/images/{{ entry.image }}" />
                  </a>
                </div>
              {% endif %}
              <p>{{ entry.intro or entry.html|striptags|truncate(300) }}</p>
            </div>
          {% endfor %}
        {% endif %}

        {% if node.is_tag_index %}
          <ul>
            {% for entry in node.index %}
              <li><a href="{{ entry.url }}">{{ entry.title }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if node.is_tag_base %}
          <ul>
            {% for child in node.children %}
              <li><a href="{{ child.url }}">{{ child.title }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if node.is_paged %}
          {% include "components/paging.jinja" %}
        {% endif %}
      </article>
    </main>
    {% include "components/site_footer.jinja" %}
  </div>
  {% include "components/meteor.jinja" %}
</div>
